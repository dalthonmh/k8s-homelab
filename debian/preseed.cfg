#### Debian 13 (Trixie) Preseed Configuration
#### Optimized for headless server installs on Hyper-V / VMware / bare metal
#### Converted and enhanced from autoinstall/cloud-init baseline

### -----------------------------
### Localization
### -----------------------------
d-i debian-installer/locale string en_US.UTF-8
d-i keyboard-configuration/xkb-keymap select us

### -----------------------------
### Network configuration
### -----------------------------
# Use automatic interface detection (works well on Hyper-V / Gen2)
d-i netcfg/choose_interface select auto
d-i netcfg/disable_dhcp boolean false
d-i netcfg/get_hostname string debian13-template
d-i netcfg/get_domain string localdomain

### -----------------------------
### Mirror settings
### -----------------------------
d-i mirror/country string manual
d-i mirror/http/hostname string deb.debian.org
d-i mirror/http/directory string /debian
d-i mirror/http/proxy string
# Optional: fallback to HTTP if HTTPS fails
d-i mirror/protocol select https

### -----------------------------
### Account setup
### -----------------------------
# Disable direct root login (use sudo)
d-i passwd/root-login boolean false
d-i passwd/user-fullname string Administrator
d-i passwd/username string superadmin
# Secure password hash (replace as needed)
d-i passwd/user-password-crypted password $6$km/ei9DnPfCusIsg$oItxoouK5z/jOcHp/dgllVMefvYzOjPoOg42r.T7E6UVV5QvVK8lEOEPYAs7O0uc7/PnnAABKd0dkebFpUZM21
# Add user to superadmin/sudo group
d-i passwd/user-default-groups string sudo adm systemd-journal

### -----------------------------
### Clock and time zone setup
### -----------------------------
d-i clock-setup/utc boolean true
d-i time/zone string UTC
d-i clock-setup/ntp boolean true
d-i clock-setup/ntp-server string time.google.com

### -----------------------------
### Partitioning
### -----------------------------
# Wipe and use full disk with ext4
d-i partman-auto/method string regular
d-i partman-auto/disk string /dev/sda
d-i partman-auto/choose_recipe select atomic
# Confirm all partitioning
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true
# Disable swap file for lightweight VMs
d-i partman-basicfilesystems/no_swap boolean true

### -----------------------------
### Base system installation
### -----------------------------
# Install generic kernel for AMD64
d-i base-installer/kernel/image string linux-image-amd64
# Ensure firmware packages are available
d-i hw-detect/load_firmware boolean true

### -----------------------------
### APT configuration
### -----------------------------
# Enable non-free and contrib sections
d-i apt-setup/non-free boolean true
d-i apt-setup/contrib boolean true
# Enable security and updates repos
d-i apt-setup/services-select multiselect security, updates
d-i apt-setup/security_host string security.debian.org
# Disable CD-ROM source
d-i apt-setup/use_mirror boolean true
d-i apt-setup/cdrom/set-first boolean false

### -----------------------------
### Package selection
### -----------------------------
# Minimal base + SSH + tools
tasksel tasksel/first multiselect standard, ssh-server

d-i pkgsel/include string \
    openssh-server \
    vim \
    curl \
    wget \
    net-tools \
    htop \
    sudo \
    ca-certificates \
    systemd-timesyncd

# Automatically update all packages
d-i pkgsel/upgrade select full-upgrade
# Disable popularity-contest
popularity-contest popularity-contest/participate boolean false

### -----------------------------
### Boot loader installation
### -----------------------------
# Install GRUB to main disk, assume single-OS environment
d-i grub-installer/only_debian boolean true
d-i grub-installer/with_other_os boolean false
d-i grub-installer/bootdev string /dev/sda
# Silence GRUB on boot (faster startup)
d-i grub-installer/timeout string 1

### -----------------------------
### Finishing up installation
### -----------------------------
d-i finish-install/reboot_in_progress note

### -----------------------------
### Late commands - Post-install tweaks
### -----------------------------
d-i preseed/late_command string \
    in-target systemctl enable ssh; \
    in-target systemctl enable systemd-timesyncd; \
    in-target sed -i 's/#PermitRootLogin.*/PermitRootLogin no/' /etc/ssh/sshd_config; \
    in-target sed -i 's/#PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config; \
    in-target usermod -aG sudo superadmin; \
    in-target apt-get update -y; \
    in-target apt-get dist-upgrade -y; \
    in-target apt-get autoremove -y; \
    in-target apt-get clean;
