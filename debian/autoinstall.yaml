#cloud-config
autoinstall:
  version: 1

  locale: en_US.UTF-8
  keyboard:
    layout: us

  identity:
    hostname: debian13-server
    username: admin
    # Password hash (sha-512). Generated with: mkpasswd -m sha-512
    password: "$6$km/ei9DnPfCusIsg$oItxoouK5z/jOcHp/dgllVMefvYzOjPoOg42r.T7E6UVV5QvVK8lEOEPYAs7O0uc7/PnnAABKd0dkebFpUZM21"

  network:
    version: 2
    ethernets:
      eth0:
        dhcp4: true

  timezone: UTC

  ssh:
    install-server: true
    allow-pw: true
    authorized-keys: []

  storage:
    layout:
      name: direct
    config:
      - id: disk0
        type: disk
        match:
          size: largest
        ptable: gpt
        wipe: superblock-recursive
        preserve: false
      - id: root-partition
        type: partition
        device: disk0
        size: 100%
      - id: root-filesystem
        type: format
        fstype: ext4
        volume: root-partition
      - id: root-mount
        type: mount
        device: root-filesystem
        path: /

  packages:
    - openssh-server
    - vim
    - curl
    - net-tools
    - htop
    - sudo

  late-commands:
    - curtin in-target --target=/target systemctl enable ssh
    - curtin in-target --target=/target apt-get update
    - curtin in-target --target=/target apt-get -y upgrade
    - curtin in-target --target=/target usermod -aG sudo admin
